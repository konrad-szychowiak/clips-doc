"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=e(require("fs"));const o=e=>e.length>0;function t(e){const n=function(e){const[n,...t]=e.split(" "),c=t.filter(o);if(o(c))return{token:n,args:c}}(e);if(n)return n}function c(e){switch(e.construct){case"RULE":return e;case"TEMPLATE":return function(e){const{src:n}=e;let t=n.split(/\(slot\ /g).filter(o);t=t.map((e=>{const[n,...o]=e.split(" ");let t=[];for(var c=0;c<o.length;c++){let e=[];if("("==o[c][0])for(e.push(o[c]);")"!==o[c][o[c].length-1];)c++,e.push(o[c]);t.push(e.join(" ").replace(/[\(\)]/g,""))}return{slotID:n,args:t}})).map((({slotID:e,args:n})=>{const o=[];let t="";return n.forEach((e=>{const[n,...c]=e.split(" ");switch(n){case"allowed-values":c.forEach((e=>o.push(e)));break;case"type":o.push(c[0]);break;case"default":t=c.join(" ")}})),{slotID:e,type:o.join("|"),default:t}}));let c=e.slots;return t.forEach((e=>{Object.assign(c[e.slotID],{type:e.type}),Object.assign(c[e.slotID],{default:e.default})})),{...e,slots:c}}(e)}}function s(e){const n=e.split("\n").filter((e=>void 0!==e)).filter(o).map(t).filter((e=>void 0!==e));if(!o(n))return;let s={slots:{},see:[]};return n.forEach((e=>{const{token:n,args:o}=e;if("RULE"!=n&&"TEMPLATE"!=n)if("SLOT_REF"!=n)"SEE"!=n?s={...s,[n.toLowerCase()]:o.join(" ")}:s.see.push(o[0]);else{const[e,...n]=o;s.slots[e]={description:n.join(" ")}}else s={...s,construct:n,identifier:o[0]}})),c(s)}function a(e,n,o){return`<h3>Source code</h3><div class="group__source"><code>${function(e,n,o){return`<code class="code__keyword">(${e}</code> <code class="code__name"><a href="#${n}">${n}</a></code> `+`${o})`.replace(/\".+\"/g,'<code class="string">$&</code>').replace(/(defrule|deftemplate|assert|read|or|and|slot)\ /g,'<code class="code__keyword">$&</code>').replace(/(printout|allowed-values|default|type|crlf|reset|exit)/g,'<code class="code__keyword"><i>$&</i></code>').replace(/(\(|\)|\<\-)/g,'<code class="code__symbol">$&</code>').replace(/\?(?=\w)/g,'<code class="code__symbol">$&</code>').replace(/=>/g,'<br/><code class="code__symbol">$&</code> ')}(e,n,o)}</code></div>`}function r(e){const{identifier:n,display_name:o,src:t,construct:c,see:s}=e;return`\n    <h2 id="${n}"><span class="rule__marker">${c}</span> ${o??n}</h2>\n    ${function({doc:e}){return e?`<h3>Description</h3><div class="pp">${e}</div>`:""}(e)}\n    ${a=s,0==a.length?"":`<h3>See also</h3><ul><li>${a.map((e=>-1==d.indexOf(e)?`<a class="unknown">${e}</a> <ins class="code__annotation">(undocumented)</ins>`:`<a href="#${e}">${e}</a>`)).map((e=>`<code class="code__name">${e}</code>`)).join("</li><li>")}</li></ul>`}\n  `;var a}function i(e){const{identifier:n,display_name:o,src:t,construct:c,slots:s}=e;return`<div class="construct__documentation">\n    ${r(e)}\n    ${function(e){return e?`<h3>Slots</h3><ul><li>${Object.keys(e).map((n=>function(e,{description:n,type:o,default:t}){return`<div>\n    <code class="code__name">${e}</code>\n    <ins class="code__annotation">type:</ins>\n    ${o.split("|").map((e=>`<code class="code__arg">${e}</code>`)).join('<code class="code__symbol">|</code>')}\n    ${function(e){switch(e){case"?NONE":return'<ins class="code__annotation">*required</ins>';case"?DERIVE":return'<ins class="code__annotation">auto</ins>';case void 0:return"";default:return`<ins class="code__annotation">default:</ins> <code class="code__arg"><i>${e}</i></code>`}}(t)}\n    <p>${n}</p>\n  </div>`}(n,e[n]))).join("</li><li>")}</li></ul>`:""}(s)}\n    ${a("deftemplate",n,t.replace(/\(slot/g,"<br/>&nbsp;&nbsp;$&"))}\n  </div>`}function l(e){const{identifier:n,display_name:o,src:t,construct:c,slots:s}=e;return`<div class="construct__documentation">\n    ${r(e)}\n    ${a("defrule",n,function(e){return e.replace(/=>/g,"$&")}(t))}\n  </div>`}const d=[];const u=function(e){return e.replace(/\ +/g," ").split(";").map(s).filter((e=>void 0!==e))}(n.default.readFileSync("clips-doc.out","utf8")),p=function(e){const n=[],o=[];e.forEach((e=>{switch(e.construct){case"RULE":o.push(e),d.push(e.identifier);break;case"TEMPLATE":n.push(e),d.push(e.identifier)}}));const t=`<body>\n    <main>\n        ${function(e,n){return`<header id="top">\n      <h1>ClipsDoc</h1>\n      <h3>Templates</h3>\n      ${e.map((e=>`<code class="code__name"><a href="#${e.identifier}">${e.identifier}</a></code>${e.display_name?`<ins class="code__annotation"> : ${e.display_name}</ins>`:""}`)).join(", ")}\n      <h3>Rules</h3>\n      ${n.map((e=>`<code class="code__name"><a href="#${e.identifier}">${e.identifier}</a></code>${e.display_name?`<ins class="code__annotation"> : ${e.display_name}</ins>`:""}`)).join(", ")}\n    </header>`}(n,o)}\n        ${n.map(i).join("")}\n        ${o.map(l).join("")}\n        <footer><h3><span class="rule__marker">^</span><a href="#top">back to top</a></h3>ClipsDoc (C) Konrad Szychowiak 2021</footer>\n    </main>\n  </body>`;return`<html><head>\n<meta charset="UTF-8"/>\n<style>\n  :root { --bg: #21252b;\n          --bg-l: #282c34;\n          --name: #cc7832;\n          --symb: #98c379;\n          --type: #6898bb;\n          --comm: #abb2bf;\n          --star: #ffc66d;\n        }\n  :root {\n    // --bg: #002b36;\n    // --name: #dc322f;\n    // --symb: #6c71c4;\n    // --type: #268bd2;\n  }\n  .string { color: var(--type); }\n  li { line-height: 1.5em; }\n  // small { color: var(--star); }\n  a { text-decoration: none; border-bottom: dotted thin #93a1a1;  color: inherit; }\n  a.unknown { color: red; cursor: not-allowed; }\n  // a:visited { color: var(--comm); }\n  body { background-color: var(--bg); color: #93a1a1; font-family: 'Ubuntu', sans-serif; }\n  h2 { color: var(--comm); margin-top: 5em; }\n  h1, h3 {color: var(--star)}\n  p,.pp { color: var(--comm); }\n  code { color: #93a1a1; font-size: 12pt; font-family: 'JetBrains Mono', monospace; }\n  .code__symbol { font-weight: bold; color: var(--symb); }\n  .code__annotation { background-color: var(--bg-l); color: #93a1a1; font-familly: 'Ubuntu', sans-serif;text-decoration: none;\n                      font-size: .75em; border-radius: 5px; padding: 0 .25em; }\n  .code__arg { font-weight: bold; color: var(--type); }\n  .code__name { font-weight: bold; color: var(--name); }\n  .code__keyword { font-weight: bold; color: var(--symb); }\n\n  .group__source { background-color: var(--bg-l); border-radius: 5px; padding: .5em; }\n  .group__fact { background-color: var(--bg-l); border-radius: 5px; padding: .25em; margin: .1em; }\n\n  .rule__marker { font-familly: 'JetBrains Mono', monospace; color: var(--star); }\n  .construct__documentation { width: 720px; }\n\n  main { display: flex; flex-direction: column; justify-content: center; align-items:center; }\n  #top { width: 720px; display: block; }\n  footer { width: 720px; margin-top: 5em; }\n  .asserts { display: flex; flex-direction: column; }\n</style></head>${t}</html>`}(u);n.default.writeFileSync("out.html",p,{encoding:"utf8"});
